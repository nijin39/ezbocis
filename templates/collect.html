{% extends "layout/base.html" %}
{% block title %}SSA COLLECT{% endblock %}
{% block head %}
    {{ super() }}
    <script src="https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css" rel="stylesheet"/>
    <script>
    function sendMacAddress() {
    	$.get("/sendMacAddress", function(data, status){
//             alert("Data: " + data + "\nStatus: " + status);
        console.log(status)
		$("#myModal").modal()
        });
    }
    
    function sendMacAddress10Times() {
    	$.get("/sendMacAddress10Times", function(data, status){
//             alert("Data: " + data + "\nStatus: " + status);
		$("#myModal").modal()
        });
    }
    </script>
{% endblock %}
{% block content %}
    <div class="row">
        <div class="col-md-4">
			<button onclick="sendMacAddress()" type="button" class="btn btn-primary btn-md pull-right">One Mac Send</button>
		</div>
		
		<div class="col-md-5">
			<form class="form-inline">
			  <div class="form-group">
			    <label for="email">MAC address:</label>
			    <input type="email" class="form-control" id="email">
			  </div>
			  <button type="submit" class="btn btn-primary btn-md">Send</button>
			</form>
		</div>
		
        <div class="col-md-3">
			<button onclick="sendMacAddress10Times()" type="button" class="btn btn-primary btn-md pull-left">Ten Mac Send</button>
		</div>
	</div>
	
	<br/>
	
	<div class="row">
		<table id="example" class="display" cellspacing="0" width="100%">
	        <thead>
	            <tr>
	                <th>Tenant</th>
	                <th>Create Date</th>
	                <th>Mac Address</th>
	                <th>Email</th>
	            </tr>
	        </thead>
	        <tfoot>
	            <tr>
	                <th>Tenant</th>
	                <th>Create Date</th>
	                <th>Mac Address</th>
	                <th>Email</th>
	            </tr>
	        </tfoot>
	    </table>
	</div>

  <!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">데이터 전송 상태</h4>
        </div>
        <div class="modal-body">
          <p>성공적으로 전송되었습니다.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>
{% endblock %}

{% block jscript %}
<script>

var accessToken = "";

$(document).ready(function() {
	$.get("/tenants/{{tenant}}", function(data, status){
		accessToken = data;
	}).done(function() {
		$("#message").text("정상적으로 로그인이 완료되었습니다.")
		$("#mymodal").modal();
		
// 		var settings = {
// 				  "async": true,
// 				  "crossDomain": true,
// 				  "url": "https://52.198.181.5:8243/ssa/v.1.0/macs",
// 				  "method": "GET",
// 				  "headers": {
// 				    "content-type": "application/json",
// 				    "authorization": "Bearer c4cc9478-3c64-3cb2-bf79-cba875a8da43",
// 				    "cache-control": "no-cache",
// 				    "Access-Control-Allow-Origin" : "http://52.198.181.5",
// 				    	"Access-Control-Allow-Methods": "POST, GET, OPTIONS",
// 				    	"Access-Control-Allow-Headers": "X-PINGOTHER, Content-Type",
// 				    	"Access-Control-Max-Age": "86400"
// 				  },
// 				  "processData": false,
// 				}

// 		$.ajax(settings).done(function (response) {
// 		  console.log(response);
// 		});

		console.log(accessToken);
		
		$('#example').DataTable({
	        "ajax": {
	            "url": "https://52.198.181.5:8243/ssa/v.1.0/macs",
	            "dataSrc": "data",
	            'beforeSend': function (request) {
	                request.setRequestHeader("authorization", "Bearer "+accessToken);
	            }
	        },
	        "columns": [
	            { "data": "tenant_id" },
	            { "data": "create_time" },
	            { "data": "macaddress" },
	            { "data": "user_id" }
	        ]
	    });
	});

	
   
});
</script>

{% endblock %}
